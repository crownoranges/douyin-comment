# 抖音评论采集与分析工具

Python工具集，用于采集和分析抖音视频评论数据。

---

## 一、功能模块

### 1. 评论采集（3个爬虫）

| 文件名 | 特点 | 评论数量 | 推荐场景 |
|-------|------|---------|---------|
| 抖音评论爬虫_API监听版.py | 监听API，数据完整  | 需要完整用户信息 |
| 抖音评论爬虫_DOM提取版.py | DOM解析，速度快  | **日常使用（最推荐）** |
| 抖音评论爬虫_DOM提取版_含回复.py | 含多级回复  | 需要分析回复关系 |

### 2. 数据分析

**评论可视化分析工具.py** - 一站式分析系统

核心功能：
- 基础统计（评论数、用户数、点赞数等）
- 情感分析（正面/中性/负面）
- 用户画像（活跃时段、语言风格、互动频率、地理分布）
- 用户影响力分析（TOP20用户）
- 关键词分析（TF-IDF算法）
- 时间趋势（24小时分布）
- 地区分布（柱状图+热力地图）
- 词云图

生成完整HTML可视化报告。

---

## 二、快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 采集评论

```bash
# 方式1：DOM提取版（推荐）
python 抖音评论爬虫_DOM提取版.py

# 方式2：API监听版
python 抖音评论爬虫_API监听版.py

# 方式3：含回复版
python 抖音评论爬虫_DOM提取版_含回复.py
```

运行后输入视频URL（可回车使用测试链接），数据保存到 `crawled_comments/` 目录。

### 分析数据

```bash
python 评论可视化分析工具.py
```

选择CSV文件（回车选最新），生成报告到 `analysis_results/` 目录。

---

## 三、关键参数调整

### 滚动次数（影响评论数量）

在脚本中找到 `range(200)` 修改：

```python
for i in range(200):  # 改这个数字
    # 100次 ≈ 400-500条
    # 200次 ≈ 800-1000条  
    # 300次 ≈ 1200-1500条
```

### 滚动速度

修改 `time.sleep(0.2)`：
- 0.2秒 - 快速
- 0.3秒 - 适中（推荐）
- 0.5秒 - 稳定

### 展开回复数（仅含回复版）

运行时输入或修改代码默认值（约139行）：

```python
expand = int(input("展开几个回复? (默认10): ").strip() or "10")
```

---

## 四、切换浏览器（Chrome → Edge）

### 修改步骤

1. **添加导入**（文件开头）：
```python
from DrissionPage import ChromiumPage, ChromiumOptions
```

2. **修改初始化**（找到 `ChromiumPage()`）：
```python
co = ChromiumOptions()
co.set_browser_path(r'C:\Program Files\Microsoft\Edge\Application\msedge.exe')
self.driver = ChromiumPage(addr_or_opts=co)
```

3. **确认Edge路径**：
   - 64位：`C:\Program Files\Microsoft\Edge\Application\msedge.exe`
   - 32位：`C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe`

需修改位置：
- 抖音评论爬虫_API监听版.py（约55行）
- 抖音评论爬虫_DOM提取版.py（约115行）
- 抖音评论爬虫_DOM提取版_含回复.py（约53行）

---

## 五、输出说明

### 采集数据

文件保存：`crawled_comments/{视频标题}_{时间戳}.csv`

字段（DOM版）：
- 评论ID, 昵称, 用户ID, 用户sec_id, 头像, 地区
- 时间, 评论, 点赞数, 回复数
- 回复给用户, 回复给用户ID, 是否置顶, 是否热评
- 包含话题, 提及用户

### 分析报告

生成文件：
- `{视频标题}_完整分析报告.html` - 所有图表合集
- `{视频标题}_词云图.png` - 词云图

报告内容：
1. 情感分析饼图
2. 用户活跃时段饼图
3. 语言风格玫瑰图
4. 互动频率饼图
5. 地理分布热力地图（彩色渐变）
6. 用户影响力排行柱状图
7. 关键词重要性柱状图
8. 24小时评论趋势折线图
9. 地区分布柱状图

---

## 六、常见问题

### Q1: 评论数量少？
- 增加滚动次数：`range(300)`
- 增加等待时间：`time.sleep(0.5)`

### Q2: 浏览器无法启动？
- 确认已安装Chrome/Edge
- 检查浏览器路径是否正确

### Q3: 需要登录吗？
- API监听版：建议登录
- DOM提取版：无需登录
- 含回复版：无需登录

### Q4: CSV文件乱码？
- 使用Excel"数据→从文本导入"，选择UTF-8编码

### Q5: 分析地图颜色显示异常？
- 已自动修复，刷新浏览器即可

---

## 七、注意事项

1. 本工具仅供学习研究使用
2. 采集的数据请妥善保管
3. 不要过于频繁采集
4. 抖音页面结构可能更新导致脚本失效

---
商业使用请标注作者。有bug和新需求请提交pull
**最后更新**: 2026-01-19
