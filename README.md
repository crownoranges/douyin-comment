# 抖音评论爬虫

一个用于采集抖音视频评论的Python工具，提供三种不同的采集方式。

---

## 一、三种版本说明

### 1. 抖音评论爬虫_API监听版.py
- **原理**: 监听浏览器网络请求，从官方API获取评论数据
- **优点**: 数据最全面（包含用户ID、sec_uid、头像URL等完整信息）
- **缺点**: 速度较慢，需要等待API响应
- **评论数量**: 通常可获取数百条
- **推荐场景**: 需要完整用户信息和详细数据的场景

### 2. 抖音评论爬虫_DOM提取版.py
- **原理**: 直接解析网页DOM结构提取评论
- **优点**: 速度极快，无需登录也能获取大量评论
- **缺点**: 只能获得一级评论，无法获取回复
- **评论数量**: 通常可获取800+条
- **推荐场景**: 快速采集大量一级评论（最推荐使用）

### 3. 抖音评论爬虫_DOM提取版_含回复.py
- **原理**: 在DOM提取基础上，自动点击"展开回复"获取多级评论
- **优点**: 可以获得一级、二级、三级评论
- **缺点**: 速度较慢（需要点击展开按钮）
- **评论数量**: 800+ 一级评论 + 若干二级评论
- **推荐场景**: 需要分析评论回复关系的场景

---

## 二、环境安装

### 1. 安装Python
确保已安装 Python 3.7 或更高版本

### 2. 安装依赖库
```bash
pip install DrissionPage
```

### 3. 安装浏览器
确保已安装 Chrome 或 Edge 浏览器

---

## 三、基本使用

### 方式一：API监听版

```bash
python 抖音评论爬虫_API监听版.py
```

运行后会提示：
```
视频URL: [输入视频链接或直接回车使用测试链接]
需要登录? (y/n): [建议输入y]
```

如果选择登录，浏览器会打开抖音主页，手动登录后按回车继续。

### 方式二：DOM提取版（推荐）

```bash
python 抖音评论爬虫_DOM提取版.py
```

运行后会提示：
```
视频URL（回车=测试URL）: [输入视频链接]
需要登录? (y/n): [通常输入n即可]
```

### 方式三：含回复版

```bash
python 抖音评论爬虫_DOM提取版_含回复.py
```

运行后会提示：
```
视频URL（回车=测试）: [输入视频链接]
展开几个回复? (默认10): [输入数字，如10、20、50等]
```

---

## 四、关键参数调整

### 4.1 调整滚动次数（影响评论数量）

**位置**: 在各个脚本中搜索 `range(200)`

#### API监听版（第81行附近）
```python
for i in range(200):  # 改这里的数字
    # 200次滚动通常可获取数百条评论
    # 建议范围: 100-300
```

#### DOM提取版（第51行附近）
```python
for i in range(200):  # 改这里的数字
    # 200次滚动通常可获取800+条评论
    # 建议范围: 150-300
```

#### 含回复版（第52行附近）
```python
for i in range(200):  # 改这里的数字
    # 与DOM提取版相同
```

**经验值参考**:
- 100次滚动 ≈ 400-500条评论
- 200次滚动 ≈ 800-1000条评论
- 300次滚动 ≈ 1200-1500条评论

**注意**: 滚动次数过多会增加运行时间，建议根据实际需求调整。

### 4.2 调整滚动速度

**位置**: 在滚动循环中搜索 `time.sleep`

```python
time.sleep(0.2)  # 改这里的数字（单位：秒）
# 0.2秒 = 快速（可能漏评论）
# 0.3秒 = 适中（推荐）
# 0.5秒 = 慢速（更稳定但耗时长）
```

### 4.3 调整展开回复数量（仅含回复版）

**方式一**: 运行时输入
```
展开几个回复? (默认10): 50  # 输入想展开的数量
```

**方式二**: 修改代码（第139行附近）
```python
expand = int(input("展开几个回复? (默认10): ").strip() or "10")
# 将 "10" 改为你想要的默认值，如 "50"
```

**注意**: 展开越多，耗时越长。每展开一个回复约需1-2秒。

---

## 五、更换浏览器内核（Chrome → Edge）

默认使用Chrome浏览器，如需切换到Edge，按以下步骤修改：

### 步骤1：修改导入语句

在文件开头找到：
```python
from DrissionPage import ChromiumPage
```

改为：
```python
from DrissionPage import ChromiumPage, ChromiumOptions
```

### 步骤2：修改浏览器初始化

找到 `self.driver = ChromiumPage()` 这一行，改为：

```python
co = ChromiumOptions()
co.set_browser_path(r'C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe')
self.driver = ChromiumPage(addr_or_opts=co)
```

### 步骤3：确认Edge路径

Edge浏览器常见路径：
- 64位系统: `C:\Program Files\Microsoft\Edge\Application\msedge.exe`
- 32位系统: `C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe`

如果路径不对，可以：
1. 打开文件资源管理器
2. 搜索 `msedge.exe`
3. 复制完整路径

### 需要修改的位置

| 文件 | 行数 | 查找内容 |
|------|------|---------|
| 抖音评论爬虫_API监听版.py | 约55行 | `self.driver = ChromiumPage()` |
| 抖音评论爬虫_DOM提取版.py | 约115行 | `self.driver = ChromiumPage()` |
| 抖音评论爬虫_DOM提取版_含回复.py | 约53行 | `self.driver = ChromiumPage()` |

---

## 六、输出说明

### 6.1 文件命名

生成的CSV文件命名规则：
```
{视频标题}_{时间戳}.csv
```

示例：
```
美国斩杀线_20260118_143256.csv
抖音日常搞笑视频_20260118_150820.csv
```

含回复版会加上 `_with_replies` 后缀：
```
美国斩杀线_20260118_143256_with_replies.csv
```

### 6.2 保存位置

所有CSV文件保存在项目目录下的 `crawled_comments` 文件夹中。

### 6.3 输出字段说明

#### API监听版（16个字段）
- 评论ID, 昵称, 用户ID, 用户sec_id, 头像, 地区
- 时间, 评论, 点赞数, 回复数
- 回复给用户, 回复给用户ID, 是否置顶, 是否热评
- 包含话题, 提及用户

#### DOM提取版（16个字段）
- 评论ID, 昵称, 用户ID, 用户sec_id, 头像, 地区
- 时间, 评论, 点赞数, 回复数
- 回复给用户, 回复给用户ID, 是否置顶, 是否热评
- 包含话题, 提及用户

注：DOM版本的"用户ID"、"用户sec_id"等字段为空（无法从DOM获取）

#### 含回复版（8个字段）
- 评论ID, 层级（1/2/3）, 昵称, 地区
- 时间, 评论内容, 点赞数, 回复数

---

## 七、常见问题

### Q1: 提取的评论数量很少？
**解决方案**:
1. 增加滚动次数：将 `range(200)` 改为 `range(300)`
2. 增加滚动等待时间：将 `time.sleep(0.2)` 改为 `time.sleep(0.5)`
3. 确保网络稳定，评论能正常加载

### Q2: 浏览器无法启动？
**解决方案**:
1. 确认已安装Chrome或Edge浏览器
2. 如果使用Edge，检查路径是否正确
3. 尝试手动指定浏览器路径（参考第五章）

### Q3: CSV文件乱码？
**解决方案**:
- 文件已使用UTF-8-BOM编码，Excel应该可以直接打开
- 如果仍有问题，使用Excel的"数据→从文本导入"功能，选择UTF-8编码

### Q4: 需要登录吗？
**建议**:
- API监听版：建议登录（数据更完整）
- DOM提取版：不需要登录（无登录也能获取大量评论）
- 含回复版：不需要登录

### Q5: 运行速度太慢？
**解决方案**:
- API监听版：减少滚动次数，如改为 `range(100)`
- DOM提取版：减少 `time.sleep` 时间，如改为 `0.1`
- 含回复版：减少展开回复的数量

### Q6: 提示找不到评论容器？
**解决方案**:
1. 检查视频URL是否正确
2. 确认视频是否开启了评论功能
3. 等待页面完全加载（可增加初始等待时间）

---

## 八、高级配置

### 8.1 修改输出目录

在代码中找到：
```python
os.makedirs('crawled_comments', exist_ok=True)
```

改为：
```python
os.makedirs('你的目录路径', exist_ok=True)
```

同时修改输出文件路径：
```python
output_file = f'你的目录路径/{video_title}_{timestamp}.csv'
```

### 8.2 调整API监听超时时间（仅API监听版）

在代码中找到：
```python
resp = self.driver.listen.wait(timeout=0.1)  # 非阻塞检查
```

和：
```python
resp = self.driver.listen.wait(timeout=1)  # 最后等待
```

根据网络情况调整timeout值（单位：秒）。

### 8.3 自定义滚动距离

在代码中找到：
```python
c.scrollTop += 2000  # 每次滚动2000像素
```

可以改为：
```python
c.scrollTop += 3000  # 更激进的滚动
c.scrollTop += 1000  # 更温和的滚动
```

---

## 九、注意事项

1. **使用规范**: 本工具仅供学习研究使用，请勿用于商业目的
2. **数据隐私**: 采集的数据请妥善保管，不得泄露或滥用
3. **频率控制**: 不要过于频繁地采集，避免对服务器造成压力
4. **账号安全**: 使用登录功能时注意账号安全
5. **页面更新**: 抖音页面结构可能更新，导致脚本失效，需及时更新代码

---

## 十、技术支持

如有问题或建议，请提交Issue。

---

**最后更新**: 2026-01-18


